{"ast":null,"code":"'use strict';\n\nvar _interopRequireDefault = require('@babel/runtime/helpers/interopRequireDefault');\nvar _typeof = require('@babel/runtime/helpers/typeof');\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports['default'] = exports.SeiWalletContext = void 0;\nvar _regenerator = _interopRequireDefault(require('@babel/runtime/regenerator'));\nvar _asyncToGenerator2 = _interopRequireDefault(require('@babel/runtime/helpers/asyncToGenerator'));\nvar _slicedToArray2 = _interopRequireDefault(require('@babel/runtime/helpers/slicedToArray'));\nvar _react = _interopRequireWildcard(require('react'));\nvar _components = require('../components');\nvar _helpers = require('./helpers');\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== 'function') return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n  if (obj === null || _typeof(obj) !== 'object' && typeof obj !== 'function') {\n    return {\n      default: obj\n    };\n  }\n  var cache = _getRequireWildcardCache(nodeInterop);\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var key in obj) {\n    if (key !== 'default' && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n  newObj['default'] = obj;\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n  return newObj;\n}\nvar SeiWalletContext = /*#__PURE__*/(0, _react.createContext)({\n  chainId: '',\n  restUrl: '',\n  rpcUrl: '',\n  accounts: [],\n  connect: function connect() {\n    return undefined;\n  },\n  disconnect: function disconnect() {\n    return undefined;\n  },\n  setConnectionError: function setConnectionError() {\n    return undefined;\n  },\n  setTargetWallet: function setTargetWallet() {\n    return undefined;\n  },\n  setShowConnectModal: function setShowConnectModal() {\n    return undefined;\n  },\n  wallets: []\n});\nexports.SeiWalletContext = SeiWalletContext;\nvar SeiWalletProvider = function SeiWalletProvider(_ref) {\n  var children = _ref.children,\n    chainConfiguration = _ref.chainConfiguration,\n    wallets = _ref.wallets,\n    autoConnect = _ref.autoConnect;\n  var autoConnectSeiWallet = typeof autoConnect === 'string' ? (0, _helpers.findWalletByWindowKey)(autoConnect) : autoConnect;\n  var _useState = (0, _react.useState)(autoConnectSeiWallet),\n    _useState2 = (0, _slicedToArray2['default'])(_useState, 2),\n    targetWallet = _useState2[0],\n    setTargetWallet = _useState2[1];\n  var _useState3 = (0, _react.useState)(),\n    _useState4 = (0, _slicedToArray2['default'])(_useState3, 2),\n    offlineSigner = _useState4[0],\n    setOfflineSigner = _useState4[1];\n  var _useState5 = (0, _react.useState)(),\n    _useState6 = (0, _slicedToArray2['default'])(_useState5, 2),\n    connectionError = _useState6[0],\n    setConnectionError = _useState6[1];\n  var _useState7 = (0, _react.useState)([]),\n    _useState8 = (0, _slicedToArray2['default'])(_useState7, 2),\n    accounts = _useState8[0],\n    setAccounts = _useState8[1];\n  var _useState9 = (0, _react.useState)(false),\n    _useState10 = (0, _slicedToArray2['default'])(_useState9, 2),\n    showConnectModal = _useState10[0],\n    setShowConnectModal = _useState10[1];\n  var _useState11 = (0, _react.useState)(),\n    _useState12 = (0, _slicedToArray2['default'])(_useState11, 2),\n    connectedWallet = _useState12[0],\n    setConnectedWallet = _useState12[1];\n  var filteredWallets = wallets.reduce(function (acc, wallet) {\n    var seiWallet = typeof wallet === 'string' ? (0, _helpers.findWalletByWindowKey)(wallet) : wallet;\n    if (seiWallet !== undefined) acc.push(seiWallet);\n    return acc;\n  }, []);\n  var disconnect = function disconnect() {\n    setTargetWallet(undefined);\n    setOfflineSigner(undefined);\n    setAccounts([]);\n    setConnectedWallet(undefined);\n  };\n  var connectToChain = /*#__PURE__*/function () {\n    var _ref2 = (0, _asyncToGenerator2['default'])( /*#__PURE__*/_regenerator['default'].mark(function _callee() {\n      var enableResponse, fetchedOfflineSigner, fetchedAccounts;\n      return _regenerator['default'].wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            if (targetWallet) {\n              _context.next = 2;\n              break;\n            }\n            return _context.abrupt('return');\n          case 2:\n            _context.prev = 2;\n            if (window[targetWallet.walletInfo.windowKey]) {\n              _context.next = 6;\n              break;\n            }\n            setConnectionError(targetWallet.walletInfo.windowKey);\n            return _context.abrupt('return');\n          case 6:\n            _context.next = 8;\n            return targetWallet.connect(chainConfiguration.chainId);\n          case 8:\n            enableResponse = _context.sent;\n            _context.next = 11;\n            return targetWallet.getOfflineSigner(chainConfiguration.chainId);\n          case 11:\n            fetchedOfflineSigner = _context.sent;\n            if (fetchedOfflineSigner) {\n              _context.next = 16;\n              break;\n            }\n            setConnectionError(targetWallet.walletInfo.windowKey);\n            disconnect();\n            return _context.abrupt('return');\n          case 16:\n            _context.next = 18;\n            return targetWallet.getAccounts(chainConfiguration.chainId);\n          case 18:\n            fetchedAccounts = _context.sent;\n            if (!(fetchedAccounts.length === 0)) {\n              _context.next = 25;\n              break;\n            }\n            setConnectionError(targetWallet.walletInfo.windowKey);\n            disconnect();\n            return _context.abrupt('return');\n          case 25:\n            setShowConnectModal(false);\n            setOfflineSigner(fetchedOfflineSigner);\n            setAccounts(fetchedAccounts);\n            setConnectedWallet(targetWallet);\n          case 29:\n            _context.next = 36;\n            break;\n          case 31:\n            _context.prev = 31;\n            _context.t0 = _context['catch'](2);\n            console.error('Error connecting to wallet', _context.t0);\n            setConnectionError(targetWallet.walletInfo.windowKey);\n            return _context.abrupt('return');\n          case 36:\n          case 'end':\n            return _context.stop();\n        }\n      }, _callee, null, [[2, 31]]);\n    }));\n    return function connectToChain() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  (0, _react.useEffect)(function () {\n    if (targetWallet) {\n      connectToChain().then();\n    } else {\n      setOfflineSigner(undefined);\n      setAccounts([]);\n      setConnectedWallet(undefined);\n    }\n  }, [targetWallet, chainConfiguration.chainId]);\n  var contextValue = {\n    chainId: chainConfiguration.chainId,\n    restUrl: chainConfiguration.restUrl,\n    rpcUrl: chainConfiguration.rpcUrl,\n    wallets: filteredWallets,\n    connect: setTargetWallet,\n    disconnect: disconnect,\n    accounts: accounts,\n    offlineSigner: offlineSigner,\n    connectedWallet: connectedWallet,\n    targetWallet: targetWallet,\n    setTargetWallet: setTargetWallet,\n    showConnectModal: showConnectModal,\n    setShowConnectModal: setShowConnectModal,\n    connectionError: connectionError,\n    setConnectionError: setConnectionError\n  };\n  return /*#__PURE__*/_react['default'].createElement(SeiWalletContext.Provider, {\n    value: contextValue\n  }, children, /*#__PURE__*/_react['default'].createElement(_components.WalletSelectModal, {\n    wallets: filteredWallets\n  }));\n};\nvar _default = SeiWalletProvider;\nexports['default'] = _default;","map":{"version":3,"names":["_react","_interopRequireWildcard","require","_components","_helpers","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","SeiWalletContext","createContext","connect","undefined","disconnect","_useState8","setConnectionError","_slicedToArray2","setTargetWallet","useState","setShowConnectModal","_useState12","SeiWalletProvider","_ref","children","chainConfiguration","wallets","autoConnect","autoConnectSeiWallet","findWalletByWindowKey","_useState","_useState2","_useState3","_useState4","_useState5","_useState6","_useState7","_useState9","_useState10","_useState11","reduce","acc","wallet","push","seiWallet","_asyncToGenerator2","_regenerator","mark","_callee","fetchedOfflineSigner","fetchedAccounts","wrap","_callee$","_context","prev","next","targetWallet","abrupt","window","walletInfo","windowKey","chainId","sent","getOfflineSigner","getAccounts","length","setOfflineSigner","setAccounts","setConnectedWallet","t0","console","error","stop"],"sources":["../../../src/lib/provider/SeiWalletProvider.tsx"],"sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\nimport { AccountData, OfflineSigner } from '@cosmjs/proto-signing';\nimport { SeiWalletProviderProps, WalletProvider } from './types';\nimport { WalletSelectModal } from '../components';\nimport { SeiWallet } from '@sei-js/core';\nimport { findWalletByWindowKey } from './helpers';\n\nexport const SeiWalletContext = createContext<WalletProvider>({\n\tchainId: '',\n\trestUrl: '',\n\trpcUrl: '',\n\taccounts: [],\n\tconnect: () => undefined,\n\tdisconnect: () => undefined,\n\tsetConnectionError: () => undefined,\n\tsetTargetWallet: () => undefined,\n\tsetShowConnectModal: () => undefined,\n\twallets: []\n});\n\nconst SeiWalletProvider = ({ children, chainConfiguration, wallets, autoConnect }: SeiWalletProviderProps) => {\n\tconst autoConnectSeiWallet = typeof autoConnect === 'string' ? findWalletByWindowKey(autoConnect) : autoConnect;\n\n\tconst [targetWallet, setTargetWallet] = useState<SeiWallet | undefined>(autoConnectSeiWallet);\n\tconst [offlineSigner, setOfflineSigner] = useState<OfflineSigner>();\n\tconst [connectionError, setConnectionError] = useState<string>();\n\tconst [accounts, setAccounts] = useState<readonly AccountData[]>([]);\n\tconst [showConnectModal, setShowConnectModal] = useState<boolean>(false);\n\tconst [connectedWallet, setConnectedWallet] = useState<SeiWallet | undefined>();\n\n\tconst filteredWallets = wallets.reduce((acc: SeiWallet[], wallet) => {\n\t\tconst seiWallet = typeof wallet === 'string' ? findWalletByWindowKey(wallet) : wallet;\n\t\tif (seiWallet !== undefined) acc.push(seiWallet);\n\t\treturn acc;\n\t}, []);\n\n\tconst disconnect = () => {\n\t\tsetTargetWallet(undefined);\n\t\tsetOfflineSigner(undefined);\n\t\tsetAccounts([]);\n\t\tsetConnectedWallet(undefined);\n\t};\n\n\tconst connectToChain = async () => {\n\t\tif (!targetWallet) return;\n\n\t\ttry {\n\t\t\tif (!window[targetWallet.walletInfo.windowKey as never]) {\n\t\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst enableResponse = await targetWallet.connect(chainConfiguration.chainId);\n\t\t\tconst fetchedOfflineSigner = await targetWallet.getOfflineSigner(chainConfiguration.chainId);\n\n\t\t\tif (!fetchedOfflineSigner) {\n\t\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\t\tdisconnect();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst fetchedAccounts = await targetWallet.getAccounts(chainConfiguration.chainId);\n\n\t\t\tif (fetchedAccounts.length === 0) {\n\t\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\t\tdisconnect();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tsetShowConnectModal(false);\n\t\t\t\tsetOfflineSigner(fetchedOfflineSigner);\n\t\t\t\tsetAccounts(fetchedAccounts);\n\t\t\t\tsetConnectedWallet(targetWallet);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Error connecting to wallet', e);\n\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\treturn;\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tif (targetWallet) {\n\t\t\tconnectToChain().then();\n\t\t} else {\n\t\t\tsetOfflineSigner(undefined);\n\t\t\tsetAccounts([]);\n\t\t\tsetConnectedWallet(undefined);\n\t\t}\n\t}, [targetWallet, chainConfiguration.chainId]);\n\n\tconst contextValue: WalletProvider = {\n\t\tchainId: chainConfiguration.chainId,\n\t\trestUrl: chainConfiguration.restUrl,\n\t\trpcUrl: chainConfiguration.rpcUrl,\n\t\twallets: filteredWallets,\n\t\tconnect: setTargetWallet,\n\t\tdisconnect,\n\t\taccounts,\n\t\tofflineSigner,\n\t\tconnectedWallet,\n\t\ttargetWallet,\n\t\tsetTargetWallet,\n\t\tshowConnectModal,\n\t\tsetShowConnectModal,\n\t\tconnectionError,\n\t\tsetConnectionError\n\t};\n\n\treturn (\n\t\t<SeiWalletContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t<WalletSelectModal wallets={filteredWallets} />\n\t\t</SeiWalletContext.Provider>\n\t);\n};\n\nexport default SeiWalletProvider;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}